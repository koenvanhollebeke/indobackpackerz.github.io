<!DOCTYPE html>
<html>

<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Whatsthesnorkeling like by Indobackpackerz</title>
  <meta name="snorkeling spots in asia" content="">
  <meta name="Koen Vanhollebeke" content="">
  
  <link rel="shortcut icon" href="./coral.ico" type="image/x-icon">
  <link rel="icon" href="./coral.ico" type="image/x-icon">

  <style>
	html,
	body { height: 100vh; width: 100vw; padding: 0; margin: 0; background: #141515; overflow: hidden;}
	#wrapper { left: 0px; top: 42px; bottom: 20px; right: 0; position: absolute; }
	#footer { bottom: 3px; right: 0; left: 0; position: absolute; width: 100%; text-align: center; font-family: "montserrat-regular", sans-serif;
  font-size: 0.7rem; color: #ffffff; }
	#map-canvas { top: 1px; bottom: 0px; overflow: auto; position: absolute; left: 0; right: 0; }
 
    #map-container { display: flex; position:absolute; width: 100%; height: 100%; z-index: 3; }
    #starfield-container { display: flex; position:absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    #globe-glow { display: flex; top: 0; position:absolute; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

    .rounded-rect { background: rgb(31, 28, 28); border-radius: 10px; box-shadow: 0 0 50px -25px black; }
    .flex-center { display: flex; position: absolute; align-items: top; flex-direction: column; flex-wrap: nowrap; overflow: auto; -webkit-overflow-scrolling: touch; -ms-overflow-style: -ms-autohiding-scrollbar; }
    .flex-center.right { right: 0px; }
    .sidebar-content { top:0; width: 80%; height: 90%; font-family: Arial, Helvetica, sans-serif; font-size: 16px; color: white; flex: 0 0 auto; }
    .sidebar { transition: transform 0.5s; z-index: 3; width: 600px; height: 100%; }
    .right.collapsed { width: 0px; }
		.flex-item { margin: 1em; }
		.my-image { margin-right: 8px; margin-top: 8px; } 
		.cursor { cursor: pointer; }
		img.hover-shadow { transition: 0.3s; }
		.hover-shadow:hover { box-shadow: 0 4px 8px 0 rgba(240, 240, 240, 0.2), 0 6px 20px 0 rgba(240, 240, 240, 0.19); }

		/* The Modal (background) */
		.modal { position: fixed; z-index: 4; padding-top: 30px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: black; }
		/* Modal Content */
		.modal-content { position: relative; background-color: #fefefe; margin: auto; padding: 0; width: 90%; max-width: 750px; max-height: 100vh; }
		/* The Close Button */
		.close { color: white; position: absolute; top: 10px; right: 25px; font-size: 35px; font-weight: bold; }
		.close:hover,
		.close:focus { color: #999; text-decoration: none; cursor: pointer; }
		/* Next & previous buttons */
		.prev,
		.next { cursor: pointer; position: absolute; top: 50%; width: auto; padding: 16px; margin-top: -50px; color: white; font-weight: bold; font-size: 20px; transition: 0.6s ease; border-radius: 0 3px 3px 0; user-select: none; -webkit-user-select: none; }
		/* Position the "next button" to the right */
		.next { right: 0; border-radius: 3px 0 0 3px; }
		/* On hover, add a black background color with a little bit see-through */
		.prev:hover,
		.next:hover { background-color: rgba(0, 0, 0, 0.8); }
		/* Number text (1/3 etc) */
		.numbertext { color: #f2f2f2; font-size: 12px; padding: 8px 12px; position: absolute; top: 0; }
		.caption-container { text-align: center; background-color: black; padding: 2px 16px; color: white; }
		img { margin-bottom: -4px; }
		.caption-container { text-align: center; background-color: black; padding: 2px 16px; color: white; }
		.demo { opacity: 0.6; }
		.active,
		.demo:hover { opacity: 1; }

	  /* Mapzoom Custom control styling */
    .custom-map-control {
      background-color: rgba(255, 255, 255, 1);
      border-radius: 3px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      font-weight: bold;
      width: 29px;
      height: 29px;
      font-size: 10px;
      color: #333;
      display: flex;
      justify-content: center;
      /* Centers items horizontally */
      align-items: center;
      /* Ensure it's above the map but part of the map's control flow */
      z-index: 1;
      pointer-events: auto;
      /* Allow interaction with the control */
	}
	
	/* MapLibre GL Layer Manager Styles */
.layer-manager {
  background: white;
  border-radius: 4px;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  font-size: 13px;
}

/* When expanded */
.layer-manager:has(.layer-manager-panel:not([style*="display: none"])) {
  max-width: 350px;
  min-width: 150px;
}

/* When collapsed */
.layer-manager:has(.layer-manager-panel[style*="display: none"]) {
  width: auto;
  min-width: auto;
}

.layer-manager-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.layer-manager-toggle {
  background: white;
  border: none;
  cursor: pointer;
  padding: 5px;
  text-align: center;
  border-radius: 4px;
  transition: background-color 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #333;
  width: 29px;
  height: 29px;
  min-width: 29px;
  min-height: 29px;
}

.layer-manager-toggle:hover {
  background: #f5f5f5;
}

.layer-manager-toggle svg {
  display: block;
  margin: auto;
}

.layer-manager-panel {
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  padding: 10px;
}

.layer-manager-section {
  margin-bottom: 10px;
}

.layer-manager-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 2px;
  background: #f8f9fa;
  border-radius: 4px;
  font-weight: 600;
  margin-bottom: 2px;
}

.layer-manager-title span {
  margin-right: 6px;
}

.layer-manager-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.layer-manager-item {
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 4px;
  padding: 1px;
  transition: all 0.2s;
  display: grid;
  grid-template-columns: auto auto 1fr;
  grid-template-rows: auto auto;
  gap: 2px;
  align-items: center;
}

.layer-manager-item:hover {
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
	
.layer-manager-checkbox {
  cursor: pointer;
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  grid-column: 2;
  grid-row: 1;
}

.layer-manager-label {
  cursor: pointer;
  user-select: none;
  font-weight: 500;
  color: #333;
  min-width: 0;
  grid-column: 3;
  grid-row: 1;
}

.layer-manager-controls {
  display: flex;
  align-items: center;
  gap: 8px;
  grid-column: 2 / 4;
  grid-row: 2;
}

.layer-manager-opacity {
  flex: 1;
}
	
.layer-manager-btn-style {
  padding: 4px 6px;
  font-size: 16px;
}

.layer-manager-btn-style:hover {
  background: #e3f2fd;
  color: #1976d2;
}
	
/* Responsive adjustments */
@media (max-width: 600px) {
  .layer-manager {
    max-width: 280px;
    min-width: 250px;
  }
}

a,
a:visited {
  color: #0087cc;
  -webkit-transition: all 0.3s ease-in-out;
  transition: all 0.3s ease-in-out;
}

a:hover,
a:focus {
  color: #39b54a;
}


#header {
  width: 100%;
  height: 42px;
  background-color: #111111;
  position: fixed;
  left: 50%;
  -webkit-transform: translateX(-50%);
  -ms-transform: translateX(-50%);
  transform: translateX(-50%);
}

.header-logo {
  position: absolute;
  left: 40px;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
  -webkit-transition: all 1s ease-in-out;
  transition: all 1s ease-in-out;
}

.header-logo a {
  display: block;
  margin: 0;
  padding: 0;
  outline: 0;
  border: none;
  width: 155px;
  height: 35px;
  background: url("./images/logo2.png") no-repeat center;
  background-size: 155px 35px;
  font: 0/0 a;
  text-shadow: none;
  color: transparent;
  -webkit-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
}

.button {
  display: inline-block;
  font-family: "montserrat-regular", sans-serif;
  font-size: 1.2rem;
  height: 3.4rem;
  line-height: calc(5.4rem - .6rem);
  padding: 0 3rem;
  margin: 0 .3rem 1.2rem 0;
  color: #222222;
  text-decoration: none;
  cursor: pointer;
  text-align: center;
  white-space: nowrap;
  border-radius: .5rem;
  -webkit-transition: all 0.3s ease-in-out;
  transition: all 0.3s ease-in-out;
  background-color: #c5c5c5;
  border: .3rem solid #c5c5c5;
}

.button:hover {
  background-color: #b8b8b8;
  border-color: #b8b8b8;
  color: #000000;
  outline: 0;
}

.button.button-primary {
  background-color: #39b54a;
  border-color: #39b54a;
  color: #FFFFFF;
}

.button.button-primary:hover
 {
  background: #309a3f;
  border-color: #309a3f;
}

  .cta {
	position: absolute;
	right: 20px;
	top: 9px;
	float: right;
    height: 25px;
    line-height: calc(25px - .6rem);
    padding: 0 10px;
  }
  
  .source-logo {
  position: absolute;
  top: 50%;
  right: 150px;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
  -webkit-transition: all 1s ease-in-out;
  transition: all 1s ease-in-out;
}

.source-logo a {
  display: block;
  margin: 0;
  padding: 0;
  outline: 0;
  border: none;
  width: 168px;
  height: 26px;
  background: url("./images/logo3.png") no-repeat center;
  background-size: 168px 26px;
  font: 0/0 a;
  text-shadow: none;
  color: transparent;
  -webkit-transition: all 0.5s ease-in-out;
  transition: all 0.5s ease-in-out;
}

.copyright span {
  display: inline-block;
}

.copyright span::after {
  content: "|";
  display: inline-block;
  padding: 0 1rem 0 1.2rem;
  color: rgba(255, 255, 255, 0.1);
}

#popupDialog {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding-top: 35px;
            background-color: rgb(31, 28, 28);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            visibility: hidden;
			color: #ffffff;
			font-family: Arial, Helvetica, sans-serif;
        }
.closeabout { color: white; position: absolute; top: 1px; right: 5px; font-size: 35px; font-weight: bold; }
.closeabout:hover,
.closeabout:focus { color: #999; text-decoration: none; cursor: pointer; }
h1, h2, h3, h4, h5, h6, .h01, .h02, .h03, .h04, .h05, .h06 {
  color: #ffffff;
  font-style: normal;
  text-rendering: optimizeLegibility;
  margin-bottom: 2.4rem;
}

  </style>	
</head>
<body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/maplibre-gl/5.7.3/maplibre-gl.js" integrity="sha512-4qLefPK7TDle+A82wrHOa/B75+B8HH0w6Zwu6YaoXxwBrLl8tQ7UmoyS0PCWOobcq3fFe51G+AN+jVZpwN5qOw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/maplibre-gl/5.7.3/maplibre-gl.css" integrity="sha512-IylZQnfgxyZ4rs0/u4TjuOthOSWKwh47nrCPuscGnyidnt1mrhKdja/uUxfvkLaMusDAWV3DgKHHpfzNdTdGhw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="maplibre-gl-starfield-0.1.js"></script>

   <header id="header" class="row">   
   		<div class="header-logo">
	        <a href="index.html">Whatsthesnorkelinglike</a>
	    </div>
		<div class="source-logo">
	        <a href="https://indonesiabackpacking.wordpress.com/">Indobackpackerz</a>
	    </div>
		<button class="button button-primary cta" onclick="functionAbout()">About</button>
	</header>
    <div id="wrapper">    
	<div class="map-canvas">
		<div id="map-container"></div>
		<div id="starfield-container"></div>
		<div id="globe-glow"></div>
		<div id="right" class="sidebar sidebar-content rounded-rect flex-center right collapsed">
			<span class="close cursor" onclick="closeSidebar()">&times;</span>
			<div class="flex-item"></div>
		</div>
	</div>
	<div id="myModal" class="modal" hidden=true>
  	<span class="close cursor" onclick="closeModal()">&times;</span>
  	<div class="modal-content">
    	<div class="mySlides">
	  		<div class="numbertext">1 / 4</div>
      	<img src="" style="width:100%">
    	</div>
    	<a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    	<a class="next" onclick="plusSlides(1)">&#10095;</a>
		</div>
	</div>
	<div id="popupDialog">
			<span class="closeabout cursor" onclick="functionAbout()">&times;</span>
			<img src="./images/IMG_20211130_124953bis.jpg" width="100%"></img>
            <h3>Welcome to our snorkeling underwater map.</h3>
			<p>The instructions are very simple: click on a snorkeling icon and the images and necessary information will appear. Also added is the approximate reef position based on different sources. Enjoy!</p>
            
        </div>
	</div>
    <div id="footer">
		<div class="copyright">
		         	<span>Â© Copyright Indobackpackerz 2026.</span> 
		         	<span>Design influenced by <a href="http://www.styleshout.com/">styleshout</a></span>		         	
		         </div>
	</div>

  
  <script>

	function functionAbout() {
		const popDialog =
                document.getElementById(
                    "popupDialog"
                );
            popDialog.style.visibility =
                popDialog.style.visibility ===
                    "visible"
                    ? "hidden"
                    : "visible";
	}


	  /**
 * MapLibre GL Layer Manager Plugin
 * Provides UI controls for managing layer visibility, opacity, and styles
 */
class LayerManager {
  constructor(options = {}) {
    this.map = null;
    this.container = null;
    this.layers = options.layers || [];
    this.position = options.position || 'top-left';
    this.collapsed = options.collapsed || false;
//    this.styleEditors = new Map();
    this.layerConfigs = new Map();

    // Initialize layer configurations
    this.layers.forEach(layer => {
      this.layerConfigs.set(layer.id, {
        visible: layer.visible !== false,
        opacity: layer.opacity || 1.0,
        minzoom: layer.minzoom,
        maxzoom: layer.maxzoom
      });
    });
  }

  onAdd(map) {
    this.map = map;
    this.container = document.createElement('div');
    this.container.className = 'maplibregl-ctrl maplibregl-ctrl-group layer-manager';

    // Create the main panel
    this.panel = document.createElement('div');
    this.panel.className = 'layer-manager-panel';
    if (this.collapsed) {
      this.panel.style.display = 'none';
    }

    // Create header
    const header = this._createHeader();
    this.container.appendChild(header);

    // Create layers section
    const layersSection = this._createLayersSection();
    this.panel.appendChild(layersSection);

    this.container.appendChild(this.panel);

    return this.container;
  }

  onRemove() {
    this.container.parentNode.removeChild(this.container);
    this.map = null;
  }

  _createHeader() {
    const header = document.createElement('div');
    header.className = 'layer-manager-header';

    const icon = document.createElement('button');
    icon.className = 'layer-manager-toggle';
    // SVG layers icon
    icon.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
      <polyline points="2 17 12 22 22 17"></polyline>
      <polyline points="2 12 12 17 22 12"></polyline>
    </svg>`;
    icon.title = 'Toggle Layers';
    icon.onclick = () => this._togglePanel();

    header.appendChild(icon);
    return header;
  }

  _togglePanel() {
    if (this.panel.style.display === 'none') {
      this.panel.style.display = '';
      this.collapsed = false;
    } else {
      this.panel.style.display = 'none';
      this.collapsed = true;
    }
  }

  _createLayersSection() {
    const section = document.createElement('div');
    section.className = 'layer-manager-section';
    // Title
    const title = document.createElement('div');
    title.className = 'layer-manager-title';
	title.innerHTML = `<span style="vertical-align: middle;">Available Layers</span>`;
    section.appendChild(title);
    // Layers list
    const list = document.createElement('div');
    list.className = 'layer-manager-list';
    this.layers.forEach(layer => {
      const layerItem = this._createLayerItem(layer);
      list.appendChild(layerItem);
    });
    section.appendChild(list);
    return section;
  }

  _createLayerItem(layer) {
    const item = document.createElement('div');
    item.className = 'layer-manager-item';
    item.dataset.layerId = layer.id;
    // Checkbox for visibility
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'layer-manager-checkbox';
    checkbox.checked = this.layerConfigs.get(layer.id).visible;
    checkbox.onchange = (e) => this._toggleLayerVisibility(layer.id, e.target.checked);
    // Labelling
    const label = document.createElement('label');
    label.className = 'layer-manager-label';
    label.textContent = layer.name || layer.id;
    label.onclick = () => checkbox.click();
    item.appendChild(checkbox);
    item.appendChild(label);
    return item;
  }

  _toggleLayerVisibility(layerId, visible) {
    const visibility = visible ? 'visible' : 'none';
    this.map.setLayoutProperty(layerId, 'visibility', visibility);
    this.layerConfigs.get(layerId).visible = visible;
  }
}

  
  class ZoomControl {
      onAdd(map) {
        this._map = map;
        this._container = document.createElement('div'); // Create a new div element
        this._container.className = 'maplibregl-ctrl custom-map-control'; // Add SDK's control class and your custom class

        this._updateZoomHandler = () => {
          this._container.innerHTML = `${map.getZoom().toFixed(2)}`;
        };
        // Initial text with current zoom
        this._updateZoomHandler();
        // Add event listener for zoom changes
        map.on('zoomend', this._updateZoomHandler);
        return this._container;
      }

      onRemove() {
        this._container.parentNode.removeChild(this._container);
        this._map = undefined;
      }
    }
	  
		//modal functions 
  	function openModal() { document.getElementById("myModal").style.display = "block"; }
		function closeModal() {  document.getElementById("myModal").style.display = "none"; }
		var slideIndex = 0;
		function plusSlides(n) { showSlides(slideIndex += n); }
		function currentSlide(n) { showSlides(slideIndex = n); }
		function showSlides(n) {
  		var i;
  		var slides = document.querySelectorAll('.flex-item img');
  		var captionText = document.getElementsByClassName("numbertext")[0];
  		var modalImg = document.querySelector('.modal-content img');
  		n %= slides.length;
  		modalImg.src = slides[n].src;
  		captionText.innerHTML = n + 1 + ' / ' + slides.length;
		}
	function closeSidebar() {
  		$(".flex-item").empty();
//		map.flyTo({
//			center: clickcenter,
//        	zoom: zoomlevel,
//        	essential: true
//		});
		toggleIt = !collapsed;
		map.setCenter(clickcenter);
		map.setZoom(zoomlevel);
		if (coralBIG) {
		map.removeLayer('CoralmapBIG');
		map.removeSource('coralBIG');
	};
	if (coralACA) {
		map.removeLayer('CoralmapACA');
		map.removeSource('coralACA');
	};
		toggleSidebar('right');
	}	
	  
    const map = new maplibregl.Map({
  		container: "map-container",
  		zoom: 3,
  		center: [124.77939886801542, 1.596716355801881],
  		style: "arcgis_hybrid.json",
  		attributionControl: false,
    });

		map.addControl(
  		new maplibregl.NavigationControl({
    		visualizePitch: true,
    		showZoom: true,
    		showCompass: true,
  		}), 'top-left'
		);
		map.addControl(new maplibregl.ScaleControl({position: 'bottom-left'}));
		map.addControl(new maplibregl.AttributionControl({ compact: true }), 'bottom-left');

	  	map.addControl(new ZoomControl(), 'top-left');
	  
		const starryBg = new MapLibreStarryBackground({
  		starCount: 100, // Customize number of stars
  		glowIntensity: 0.1, // Customize glow intensity (0.0 to 1.0)
		});
		map.on("style.load", function () {
  		map.setProjection({ type: "globe" });
  		starryBg.attachToMap(map, "starfield-container", "globe-glow");
		});

		map.on("load", async () => {
  		const image = await map.loadImage( "https://i.ibb.co/CnhHVH3/1870-snorkel-4x.png", );
  		map.addImage("custom-marker", image.data);
  		map.addSource("snorkelingspot", {
    		type: "geojson",
    		data: "./snorkeling_indonesia_ourspots.geojson",
				});
			
  		map.addLayer({
    		id: "snorkeling-spot",
    		type: "symbol",
    		source: "snorkelingspot",
    		layout: {
      		"icon-image": "custom-marker",
      		"icon-size": [
        		"interpolate",
        		["linear"],
        		["zoom"],
        		10,
        		0.4, // At zoom 10, icon size is 0.5x
        		15,
        		0.6, // At zoom 15, icon size is 1.5x
        		20,
        		0.7, // At zoom 20, icon size is 2.0x
      		],
    		},
    		filter: ["==", "$type", "Point"],
  		});

// colors to use for the categories
const colors = ['#A52A2A', '#FF0000', '#FFA500', '#FFFF00', '#32CD32', '#008000'];
map.addSource("mermaidspot", {
    		type: "geojson",
    		data: "./snorkeling_indonesia_mermaid.geojson",
				});
			
  		map.addLayer({
    		id: "mermaid-spot",
    		'type': "circle",
    		source: "mermaidspot",
			layout: {
            visibility: "none",
          	},
    		'paint': {
				'circle-color': [
                    'case',
                    ['<=', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 10],
                    colors[0],
                    ['all', ['>', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 10], ['<=', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 25]],
                    colors[1],
                    ['all', ['>', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 25], ['<=', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 35]],
                    colors[2],
                    ['all', ['>', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 35], ['<=', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 50]],
                    colors[3],
					['all', ['>', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 50], ['<=', ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], 75]],
                    colors[4],
					colors[5],
                ],
                'circle-opacity': 0.6,
                'circle-radius': 10,
	  		},
  		});
		map.addLayer({
            'id': 'mermaid-spot_label',
            'type': 'symbol',
            'source': 'mermaidspot',
            'layout': {
                'text-field': [
                    'number-format',
                    ["+", ['to-number', ['get', 'Percent cover by benthic category average: Hard coral'], 0], ['to-number', ['get', 'Percent cover by benthic category average: Soft coral'], 0]],
                    {'min-fraction-digits': 1, 'max-fraction-digits': 1}
                ],
				'text-font': ['Noto Sans Regular'],
                'text-size': 9,
				visibility: "none",
            },
            'paint': {
                'text-color': 'white'
            }
        });
			
map.addSource("sulut", {
    type: "geojson",
    data: "https://raw.githubusercontent.com/koenvanhollebeke/gtfs-test/refs/heads/main/sulut.geojson",
  });
  map.addLayer({
    id: "SulawesiUtara",
    type: "line",
    source: "sulut",
    layout: {},
    paint: {
      "line-color": "#DDED24",
      "line-opacity": 0.4,
    },
  });

});

map.on("load", function () {
      const layerManager = new LayerManager({
        layers: [
          { id: "snorkeling-spot", name: "our spots", visible: true },
		  { id: "mermaid-spot", name: "mermaid spots", visible: false },
		  { id: "mermaid-spot_label", name: "mermaid spots %HC", visible: false },
          { id: "SulawesiUtara", name: "provinces", visible: true }
        ],
        position: "top-left",
        collapsed: true,
      });
	map.addControl(layerManager, "top-left");
});

		var zoomlevel, clickcenter, spot, zoomspot, coralBIG, coralACA;
		map.on('click', 'snorkeling-spot', (e) => {
  		var description, toggleIt, identity, date, dates, month, images, i, j;
  		const bbox = [
    		[e.point.x - 5, e.point.y - 5],
    		[e.point.x + 5, e.point.y + 5]
  		];
  		const clickedFeatures = map.queryRenderedFeatures(bbox, {
    		layers: ['snorkeling-spot']
  		});
  		if (clickedFeatures.length > 0) {
				zoomlevel = map.getZoom();
				clickcenter = map.getCenter();
    		description = clickedFeatures[0].properties.description;
				identity = clickedFeatures[0].properties.name;
				date = clickedFeatures[0].properties.date;
				dates = new Date(date);
				const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
				month = months[dates.getMonth()];
				// images = JSON.parse(clickedFeatures[0].properties.image);
				images = JSON.parse("[ " + clickedFeatures[0].properties.image.replaceAll('{{','"').replaceAll('}}','"') + " ]");
				zoomspot = clickedFeatures[0].properties.zoomlevel;
				spot = clickedFeatures[0].geometry.coordinates;
				coralBIG = clickedFeatures[0].properties.coralsourceBIG;
				coralACA = clickedFeatures[0].properties.coralsourceACA;
  		}
  		if (description) {
				var html = "";
				html += "<h1>"+ identity +"</h1>";
				html += "<p> date: " + month + " " + String(dates.getFullYear()) + "</p>";
				html += "<p>"+ description +"</p>";

//	i = images.length;
//	while (i > 0) {
//		html += '<img src=' + images[i-1] + ' width="550" >';
//		i--;
//	};
				
	if (Object.keys(images).length > 0) {
		i = Object.keys(images).length;
		j = 0;
		while (i > 0) {
			html += '<img class="my-image hover-shadow cursor" style="image-orientation: from-image" src=' + images[i-1] + ' width="100" onclick="openModal();currentSlide(' + j + ')">';
			i--;
			j++;
		};
	};

	html += '<p>&copy; Allen Coral Atlas (2020). Imagery, maps and monitoring of the world&#39;s tropical coral reefs. <a href="https://doi.org/10.5281/zenodo.3833242">doi.org/10.5281/zenodo.3833242</a></p>';
	html += '<p>&copy; Onemap - karang layer <a href="https://sidako.kkp.go.id/geoserver/index.html">Sidako geoserver</a></p>';


	$(".flex-item").empty();
  $(".flex-item").html(html);

	if (coralBIG) {
		map.addSource("coralBIG", { type: "geojson", data: coralBIG });
		map.addLayer({
    	id: "CoralmapBIG",
			type: "line",
			source: "coralBIG",
			layout: {},
			paint: {
				"line-color": "#DDED24",
				"line-opacity": 0.4,
				"line-width": 4.0,
			},
		});
	};
	if (coralACA) {
		map.addSource("coralACA", { type: "geojson", data: coralACA });
		map.addLayer({
    	id: "CoralmapACA",
			type: "fill",
			source: "coralACA",
			layout: {},
			paint: {
				"fill-color": "#DDED24",
				"fill-opacity": 0.7,
			},
		});
	};
				
  toggleIt = collapsed;
//	map.flyTo({
//		center: spot,
//        zoom: zoomspot,
//        essential: true
//	});
	map.setCenter(spot);
//	map.zoomTo(zoomspot, { duration: 1000 });
	map.setZoom(zoomspot);
    }
	
  else {
    $(".flex-item").empty();
	map.flyTo({
		center: clickcenter,
        zoom: zoomlevel,
        essential: true
	});
//	map.setCenter(clickcenter);
//	map.setZoom(zoomlevel);
//	map.zoomTo(zoomlevel, { duration: 1000 });

	if (coralBIG) {
		map.removeLayer('CoralmapBIG');
		map.removeSource('coralBIG');
	};
	if (coralACA) {
		map.removeLayer('CoralmapACA');
		map.removeSource('coralACA');
	};	
    toggleIt = !collapsed;
  }
  if (toggleIt) toggleSidebar('right');
});

// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'snorkeling-spot', () => {
  map.getCanvas().style.cursor = 'pointer';
});
// Change it back to a pointer when it leaves.
map.on('mouseleave', 'snorkeling-spot', () => {
  map.getCanvas().style.cursor = '';
});

    
var collapsed = true;
function toggleSidebar(id) {
  var elem = document.getElementById(id);
  var classes = elem.className.split(' ');
  collapsed = classes.indexOf('collapsed') !== -1;
  var padding = {};
  if (collapsed ) {
    classes.splice(classes.indexOf('collapsed'), 1);
    padding[id] = 610;
    map.easeTo({
      padding: padding,
      duration: 500 
    });
    } 
  else {
    padding[id] = 0;
    classes.push('collapsed');
    map.easeTo({
      padding: padding,
      duration: 500
    });
  }
  elem.className = classes.join(' ');
  collapsed = !collapsed;
};

  </script>
</body>
</html>
