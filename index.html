<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>globe example with arcgis and openfreemap</title>

  <style>
    body { margin: 0; padding: 0; background-color: rgb(31, 28, 28); }
    html, body, #map { height: 100%; margin: 0px; }
    #map-container { position: absolute; top: 0; bottom: 0; width: 100%; height: 100%; z-index: 3; }
    #starfield-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    #globe-glow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

    .rounded-rect { background: rgb(31, 28, 28); border-radius: 10px; box-shadow: 0 0 50px -25px black; }
    .flex-center { position: absolute; display: flex; justify-content: center; align-items: center; }
    .flex-center.right { right: 0px; }
    .sidebar-content { position: absolute; width: 95%; height: 95%; font-family: Arial, Helvetica, sans-serif; font-size: 16px; color: white; }
    .sidebar { transition: transform 0.5s; z-index: 3; width: 400px; height: 100%; }
    .right.collapsed { transform: translateX(400px); }
  </style>

  
</head>
<body>
  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
<link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="maplibre-gl-starfield-0.1.js"></script>

<div id="main">
  <div id="map-container"></div>
  <div id="starfield-container"></div>
  <div id="globe-glow"></div>
  <div id="right" class="sidebar sidebar-content rounded-rect flex-center right">
</div>
  
  <script>
    const map = new maplibregl.Map({
  container: "map-container",
  zoom: 3,
  center: [124.77939886801542, 1.596716355801881],
  style: "https://raw.githubusercontent.com/koenvanhollebeke/indobackpackerz.github.io/refs/heads/main/arcgis_hybrid.json",
    });

map.addControl(
  new maplibregl.NavigationControl({
    visualizePitch: true,
    showZoom: true,
    showCompass: true,
  }),
);

const starryBg = new MapLibreStarryBackground({
  starCount: 100, // Customize number of stars
  glowIntensity: 0.1, // Customize glow intensity (0.0 to 1.0)
});
map.on("style.load", function () {
  map.setProjection({ type: "globe" });
  starryBg.attachToMap(map, "starfield-container", "globe-glow");
});

map.on("load", async () => {
  const image = await map.loadImage(
    "https://i.ibb.co/CnhHVH3/1870-snorkel-4x.png",
  );
  map.addImage("custom-marker", image.data);
  map.addSource("snorkelingspot", {
    type: "geojson",
    data: "snorkeling_indonesia_public.geojson",
  });
  map.addLayer({
    id: "snorkeling-spot",
    type: "symbol",
    source: "snorkelingspot",
    layout: {
      "icon-image": "custom-marker",
      "icon-size": [
        "interpolate",
        ["linear"],
        ["zoom"],
        10,
        0.5, // At zoom 10, icon size is 0.5x
        15,
        0.6, // At zoom 15, icon size is 1.5x
        20,
        0.7, // At zoom 20, icon size is 2.0x
      ],
    },
    filter: ["==", "$type", "Point"],
  });

//  map.addSource("sulut", {
//    type: "geojson",
//    data: "https://raw.githubusercontent.com/koenvanhollebeke/gtfs-test/refs/heads/main/sulut.geojson",
//  });
//  map.addLayer({
//    id: "SulawesiUtara",
//    type: "line",
//    source: "sulut",
//    layout: {},
//    paint: {
//      "line-color": "#DDED24",
//      "line-opacity": 0.4,
//    },
//  });

});

map.on('click', (e) => {
  var description, toggleIt;
  const bbox = [
    [e.point.x - 5, e.point.y - 5],
    [e.point.x + 5, e.point.y + 5]
  ];
  const clickedFeatures = map.queryRenderedFeatures(bbox, {
    layers: ['snorkeling-spot']
  });
  if (clickedFeatures.length > 0) {
    description = clickedFeatures[0].properties.description;
  }
  if (description) {
    $(".sidebar-content").empty();
    $(".sidebar-content").append(description)
    toggleIt = collapsed;
    }
  else {
    toggleIt = !collapsed;
  }
  if (toggleIt) toggleSidebar('right');
});

// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'snorkeling-spot', () => {
  map.getCanvas().style.cursor = 'pointer';
});
// Change it back to a pointer when it leaves.
map.on('mouseleave', 'snorkeling-spot', () => {
  map.getCanvas().style.cursor = '';
});

    
var collapsed = true;
function toggleSidebar(id) {
  var elem = document.getElementById(id);
  var classes = elem.className.split(' ');
  collapsed = classes.indexOf('collapsed') !== -1;
  var padding = {};
  if (collapsed ) {
    classes.splice(classes.indexOf('collapsed'), 1);
    padding[id] = 410;
    map.easeTo({
      padding: padding,
      duration: 500 
    });
    } 
  else {
    padding[id] = 0;
    classes.push('collapsed');
    map.easeTo({
      padding: padding,
      duration: 500
    });
  }
  elem.className = classes.join(' ');
  collapsed = !collapsed;
};

  </script>
</body>
</html>



